<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Rohit&#39;s Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Rohit&#39;s Blog Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="Rohit&#39;s Blog JSON Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-rh="true">Execution of compiled languages | Rohit&#x27;s Blog</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://s4dr0t1.github.io/img/opengraph.png"><meta data-rh="true" name="twitter:image" content="https://s4dr0t1.github.io/img/opengraph.png"><meta data-rh="true" property="og:url" content="https://s4dr0t1.github.io/docs/programming/Program Execution/execution-compile"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Execution of compiled languages | Rohit&#x27;s Blog"><meta data-rh="true" name="description" content="Understanding different stages of compilation and the technicalities involved"><meta data-rh="true" property="og:description" content="Understanding different stages of compilation and the technicalities involved"><link data-rh="true" rel="icon" href="/img/logo.png"><link data-rh="true" rel="canonical" href="https://s4dr0t1.github.io/docs/programming/Program Execution/execution-compile"><link data-rh="true" rel="alternate" href="https://s4dr0t1.github.io/docs/programming/Program Execution/execution-compile" hreflang="en"><link data-rh="true" rel="alternate" href="https://s4dr0t1.github.io/docs/programming/Program Execution/execution-compile" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.4612e351.css">
<link rel="preload" href="/assets/js/runtime~main.b55d8945.js" as="script">
<link rel="preload" href="/assets/js/main.8c95a7e4.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_aKYr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="aHR0cHM6Ly94a2NkLmNvbS8yMTc2Lwo=" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.png" alt="aHR0cHM6Ly94a2NkLmNvbS8yMTc2Lwo=" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">s4dr0t1</b></a><a class="navbar__item navbar__link" href="/blog">Blog</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">My Infosec Ramblings</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/projects">Projects</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/#about">About</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y sidebarWithHideableNavbar_FoYL"><a tabindex="-1" class="sidebarLogo_FJUI" target="_self" href="/"><img src="/img/logo.png" alt="aHR0cHM6Ly94a2NkLmNvbS8yMTc2Lwo=" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.png" alt="aHR0cHM6Ly94a2NkLmNvbS8yMTc2Lwo=" class="themedImage_W2Cr themedImage--dark_oUvU"><b>s4dr0t1</b></a><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/cryptography/crypto101">Cryptography</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/os/os-basics">Operating System</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/programming/pl-basics">Programming</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/programming/pl-basics">Basics</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/programming/Program Execution/execution-compile">Program Execution</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/programming/Program Execution/execution-compile">Execution of compiled languages</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/programming/Program Execution/interediate-interpreted-execution">Execution of interpreted and intermediate languages</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/programming/Intermediate-Representation">Intermediate Representation (IR)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/programming/decompilers-disassemblers">Decompilers and Disassemblers</a></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_cwdi"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_xORG"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/">ğŸ </a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">Programming</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">Program Execution</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docs/programming/Program Execution/execution-compile">Execution of compiled languages</a></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Execution of compiled languages</h1></header><blockquote><p>Understanding different stages of compilation and the technicalities involved</p></blockquote><h1>Different steps of compilation</h1><p>There is a lot of stuff, so we will try to go through them one by one, also we will look at the process from the view of the C programming language.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="writing-code">Writing code<a class="hash-link" href="#writing-code" title="Direct link to heading">â€‹</a></h2><p>For the code to compile, we need to write the code in the first place, this part is all about writing the code, which is an integral part of the <a href="https://en.wikipedia.org/wiki/Systems_development_life_cycle" target="_blank" rel="noopener noreferrer">SDLC</a>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="pre-processing">Pre-processing<a class="hash-link" href="#pre-processing" title="Direct link to heading">â€‹</a></h2><p>In this phase, the pre-processor does removal of comments, and other special statements such as preprocessor directives and deal with them accordingly. For example, if we are including the <code>stdio</code> library in our code, <code>#include &lt;stdio.h&gt;</code>, the preprocessor will put all the function prototypes into our main code, so that the compiler can figure out what kind of arguments can be passed to the function, whether it&#x27;s defined locally, or can it be discovered in some other library</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cpp &lt;filename.c&gt; | less</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#or </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ clang -E &lt;filename.C&gt; | less</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><img loading="lazy" alt="Preprocessing" src="/assets/images/preprocessing-24fa3c19dacdd38f7187f122d9171cb5.png" width="1918" height="1002"></p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="compilation">Compilation<a class="hash-link" href="#compilation" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="what-are-compilers">What are compilers?<a class="hash-link" href="#what-are-compilers" title="Direct link to heading">â€‹</a></h3><ul><li>Speaking in a generic sense, compilers are used to convert code written in one language to another. The notion that compilers translate HLLs to low-level languages is prevalent, but not necessary, as it can also be used to convert b/w two HLLs (see <a href="https://en.wikipedia.org/wiki/Source-to-source_compiler" target="_blank" rel="noopener noreferrer">Transpilation</a>), for example <a href="https://babeljs.io/" target="_blank" rel="noopener noreferrer">Babel</a>.</li><li>Apart from code translation, they are also used in code optimization and error handling</li></ul><p><img loading="lazy" alt="Preprocessing" src="/assets/images/compiler-basic-25a980630ceb6095f45f7f8e54c09bb6.png" width="1424" height="446"></p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="overview-of-c-compilation">Overview of C compilation<a class="hash-link" href="#overview-of-c-compilation" title="Direct link to heading">â€‹</a></h3><ul><li>The C compiler takes HLL source code and converts it into an intermediate form called object code.</li><li>The conversion from HLL to machine code is done all at once, which is why this type of compilation is known as <a href="https://en.wikipedia.org/wiki/Ahead-of-time_compilation" target="_blank" rel="noopener noreferrer">Ahead Of Time Compilation</a> (AOT).
T- The outcome of the compilation phase is multiple object files (<code>.o</code>, <code>.obj</code>), which are native to our ISA and microarchitecture, the only difference being they contain additional metadata such as relocation table, symbol table and what not, to augment the Linking step, in order to make the executable blocks identifiable and relocatable.</li><li>Has a lot of sub-phases: Lexical Analysis, Syntax Analysis, Semantic Analysis, Intermediate Code Generation, Code Optimization and Code Generation, and we will go through them one by one.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="lexical-analysis-tokenisation">Lexical Analysis (Tokenisation)<a class="hash-link" href="#lexical-analysis-tokenisation" title="Direct link to heading">â€‹</a></h3><ul><li>The lexical analyzer breaks down the source program into lexical units (or <em>lexemes</em>), which are things which hold some meaning such as identifiers, special words, operators, punctuation symbols etc.</li><li>Error checking is also done at this stage, if some characters are not allowed, the lexical analyzer reports them to us.</li></ul><div class="codeBlockContainer_I0IT language-cpp theme-code-block"><div class="codeBlockContent_wNvx cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">String greeting </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Hello&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">    Five lexemes are there:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">    - String</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">    - greeting </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">    - = </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">    - &quot;hello&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">    - ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">*/</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="parsing-syntax-analysis">Parsing (Syntax Analysis)<a class="hash-link" href="#parsing-syntax-analysis" title="Direct link to heading">â€‹</a></h3><ul><li>The syntax analyzer takes in the sequence of tokens generated at the previous step, to create hierarchical structures called <strong>Parse Trees</strong>, which represent the logical structure of a program, and the original source code can also be obtained back from the Parse Tree by walking the tree down the right order.</li><li>Having a <em>tree</em> like shape is important because it allows the compiler to conduct multiple-passes while generating the machine language without having to re-parse the original source code.</li><li>In this phase, some degree of error checking is also there</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="semantic-analysis">Semantic Analysis<a class="hash-link" href="#semantic-analysis" title="Direct link to heading">â€‹</a></h3><ul><li>In this phase, the parse tree is used to detect any logical errors such as assigning a wrong type to a variable, undeclared variable usage etc, and in general three things are done: Type checking, Flow control checking and Label checking.</li><li>The compiler makes a complete traversal of the parse tree (abstract syntax tree or AST) and produces an <em>Annotated AST</em> which also describes the values of its attributes</li></ul><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ clang -Xclang -ast-dump &lt;filename.c&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="intermediate-code-generation">Intermediate Code Generation<a class="hash-link" href="#intermediate-code-generation" title="Direct link to heading">â€‹</a></h3><p>During this step, our code gets translated into a language somewhat b/w pure assembly and the source language (<em>Intermediate Language</em>)</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ clang -Xclang -disableO0-optnone -S -emit-llvm &lt;code.c&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="code-optimization">Code Optimization<a class="hash-link" href="#code-optimization" title="Direct link to heading">â€‹</a></h3><ul><li>The compiler uses a variety of techniques to enhance the efficiency of our code, which is done at the intermediate code level because machine code is hard to optimize because of the platform dependency</li><li>Optimization generally leads to faster execution speeds and/ or smaller binary sizes </li><li>There are three rules that must be absolutely followed at this stage:<ul><li>The program must consume fewer resources than before </li><li>The original meaning of the program must not change due to optimization </li><li>It shouldn&#x27;t be too time consuming</li></ul></li></ul><p>Check this <a href="https://stackoverflow.com/questions/15548023/clang-optimization-levels" target="_blank" rel="noopener noreferrer">link</a> to understand more about code optimization flags.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="code-generation">Code Generation<a class="hash-link" href="#code-generation" title="Direct link to heading">â€‹</a></h3><p>The optimised intermediate code is then converted fully into the machine code (<code>.o</code>/ <code>.obj</code>)</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="linking">Linking<a class="hash-link" href="#linking" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="basics">Basics<a class="hash-link" href="#basics" title="Direct link to heading">â€‹</a></h3><ul><li>It&#x27;s the process of combining various pieces of code and data into a single file that can be loaded into the memory and executed. All this magic is performed by <strong>Linker</strong></li><li>The linker takes in an object file, looks for unresolved symbols and find where they exist with the help of relocation information and either place them into our main code (static linking) or do something which would lead to them being resolved at runtime (dynamic linking)</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="what-are-symbols">What are symbols?<a class="hash-link" href="#what-are-symbols" title="Direct link to heading">â€‹</a></h3><ul><li>Symbols are identifiers that are used to identify something when theyâ€™re used outside of where they were declared </li><li>They are stored in a symbol table which is built during the assembly phase. We can inspect them using nm/ readelf.</li></ul><div class="codeBlockContainer_I0IT language-nasm theme-code-block"><div class="codeBlockContent_wNvx nasm"><pre tabindex="0" class="prism-code language-nasm codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">global _start</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">section .text</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token label function" style="color:rgb(130, 170, 255)">_start:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        xor </span><span class="token register variable" style="color:rgb(191, 199, 213)">RAX</span><span class="token plain">, </span><span class="token register variable" style="color:rgb(191, 199, 213)">RAX</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        mov </span><span class="token register variable" style="color:rgb(191, 199, 213)">ECX</span><span class="token plain">, someLabelName</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">section .data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token label function" style="color:rgb(130, 170, 255)">someLabelName:</span><span class="token plain"> dw </span><span class="token number" style="color:rgb(247, 140, 108)">0x1234</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>If we convert the above assembly into its corresponding ELF, and try to read the symbols using <code>nm</code>:</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ nasm code.asm -o objectfile.o -f elf64</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ ld objectfile.o -o finalExecutable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ nm -a ./finalExecutable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># These are all the things which are referenced outside of where they have been declared, so they count as symbols</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">0000000000402002 D __bss_start</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">0000000000402002 D _edata</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">0000000000402008 D _end</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">0000000000000000 a hi.asm</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">0000000000402000 d someLabelName</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">0000000000401000 T _start</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li>Lowercase is used to denote that the symbol is local, and uppercase is used to denote that it is an external symbol.</li><li>Symbol binding can either be local or global. Only the static symbols are local scoped, rest all are given Global and Global (extern). Local non-static variables are of no interest to the linker and are managed on the runtime stack.</li><li>Symbols can either be Strong (defined functions/ initialised variables), or weak (uninitialised variables). Multiple symbols with the same name are not allowed, and a strong symbol is always picked over the weak.</li></ul><table><thead><tr><th>Type of symbol</th><th>Description</th></tr></thead><tbody><tr><td>A</td><td>Absolute Symbol</td></tr><tr><td>B</td><td>In the BSS section</td></tr><tr><td>D</td><td>In the data section</td></tr><tr><td>N</td><td>Debugging symbol used for debugging</td></tr><tr><td>T</td><td>In the text section</td></tr><tr><td>U</td><td>Undefined</td></tr></tbody></table><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="the-symbol-table">The symbol table<a class="hash-link" href="#the-symbol-table" title="Direct link to heading">â€‹</a></h3><p>A symbol table is used to store information about the symbols</p><div class="codeBlockContainer_I0IT language-c theme-code-block"><div class="codeBlockContent_wNvx c"><pre tabindex="0" class="prism-code language-c codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">typedef</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain">   name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* offset into the string table that points to the null terminated string name of the symbol */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain">    type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">       </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* Function or data (4 bits) */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    binding</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* Local or global */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain">    reserved</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* Unused */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">short</span><span class="token plain">   section</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* Which section this symbol is associated to, viz. index in the section header table */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">long</span><span class="token plain">    value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* The address */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">long</span><span class="token plain">    size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">       </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* Object size in bytes */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> Elf64_Symbol</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="how-an-object-file-looks-like-elf-perspective">How an object file looks like (ELF perspective)<a class="hash-link" href="#how-an-object-file-looks-like-elf-perspective" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              â”‚ ELF header  â”‚ Basic information about the object file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              â”‚ .text       â”‚ Contains the code that we write</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              â”‚ .rodata     â”‚ Read only data</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              â”‚ .data       â”‚ Contains globally initialized data</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              â”‚ .bss        â”‚ Contains globally uninitialized data, stuff present in the bss section doesn&#x27;t need memory</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              â”‚ .symtab     â”‚ The symbol table</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              â”‚ .rel.text   â”‚ Relocation information (more on this later)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              â”‚ .rel.data   â”‚ Relocation information (more on this later)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              â”‚ .debug      â”‚ Debugging symbol table</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              â”‚ .line       â”‚ Mapping b/w original code and machine instructions</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              â”‚ .strtab     â”‚ String table</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              â”‚ Section     â”‚ Useful information for linking (not execution)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              â”‚ header tableâ”‚</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Apart from the things discussed above, there are a bunch of other miscellaneous but important things too, such as
<code>.PLT</code> (Procedural Linkage Table) and <code>.GOT</code> (Global Offset Table): They are used to resolve library calls and are useful in the case of dynamic linking</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>What is the ELF file format?</h5></div><div class="admonition-content"><p>I&#x27;ve been throwing the term ELF for a while now, but never got about explaining it. ELF stands for Executable and Linkable Format. It contains the program data, the code, and some metadata which is used to determine how it can be linked and loaded in the memory</p><p>Itâ€™s the successor of the COFF (Common Object File Format) of <!-- -->*<!-- -->NIX like operating systems.</p></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="static-linking">Static Linking<a class="hash-link" href="#static-linking" title="Direct link to heading">â€‹</a></h3><ul><li>The object files of the functions which are called using libraries, is created and linked together during the linking phase to create an executable, making the size of the executable large.</li><li>This approach is good for particular libraries if some of its functions are used a lot of times, but each time something gets changed in the library, the whole executable needs to be recreated.</li></ul><p><img loading="lazy" alt="Preprocessing" src="/assets/images/static-linking-bfe48a849eb11b0e29647043e33abae4.png" width="2398" height="1378"></p><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="phase-1-symbol-resolution">Phase 1: Symbol Resolution<a class="hash-link" href="#phase-1-symbol-resolution" title="Direct link to heading">â€‹</a></h4><ul><li>During the assembly phase, a symbol table is generated, which lists out all the symbols in an object module. </li><li>During this phase, symbol resolution takes place, by which a single definition to each symbol is found and associated with, which is done by going through unresolved symbols, and finding the places where they actually exist viz. mapping of symbol names to their definition</li><li>If more than one symbol exists with the same name, then the concept of strong/ weak symbols is brought into the picture. </li><li>The C linker goes through the whole codebase in a single pass, and takes note of unresolved symbol references as they occur, and as soon as the definitions are found, place them on the symbol table. </li><li>The following information is maintained: set of relocatable object files that will be merged to form the executable (E), set of unresolved symbols (U), and set of symbols that have been defined in the previous input files (D)</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="phase-2-symbol-relocation">Phase 2: Symbol Relocation<a class="hash-link" href="#phase-2-symbol-relocation" title="Direct link to heading">â€‹</a></h4><ul><li>At the end of the previous phase, all the symbols get resolved with their correct definitions, this phase is all about creating the final executable and fixing the references to these symbols.</li><li>A new executable is created which has the combined .text and .data section of all the libraries, along with that of its main program.</li><li>Now that we know the correct definitions for symbols, we can fix the references made to these symbols with their correct runtime addresses, that were left zeroed out as placeholders during the assembly phase because the assembler didnâ€™t know what their runtime address would be in the program address space</li><li>The linker will look at the relocation tables (.rel.text and .rel.data) to see which symbols need relocation (the zeroed out ones). All resolved symbolsâ€™s definitions will have specific addresses in the newly created executable, and these address will be put into those placeholders.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="dynamic-linking">Dynamic Linking<a class="hash-link" href="#dynamic-linking" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_I0IT language-c theme-code-block"><div class="codeBlockContent_wNvx c"><pre tabindex="0" class="prism-code language-c codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">typedef</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">long</span><span class="token plain"> offset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* Offset of the reference which needs to be relocated */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">long</span><span class="token plain"> type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* How to modify the reference, there are 32 relocation types in the ELF format */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    symbol</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* Index in the symbol table, used to find the resolved address for the symbol */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">long</span><span class="token plain"> addend</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* Used by some implementations to change the value of modified reference */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> Elf64_Rela</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li>Another approach is to not link the object files during linking phase, and instead use a dynamic linker to link the global variables at load time and link the library functions at invocation time, keeping the size of the binary small.</li><li>References to library object modules will be fixed during the invocation time, and these will be just pointers to where theyâ€™re located in memory, they will not be put into our binary, allowing multiple processes sharing the same set of libraries and saving memory.</li><li>Static linking leads to wastage of a lot of memory because the same library code is loaded along with the main executable multiple times. And whenever thereâ€™s some change made to any library, the executable needs to be recreated. By this technique, the executable need not be re-created every time some changes are made into the library code, and the library code can stay in L1 cache ensuring super fast access either as shared object .so (Linux) or .dll (Windows) </li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="loading">Loading<a class="hash-link" href="#loading" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="understanding-elf-program-headers">Understanding ELF program headers<a class="hash-link" href="#understanding-elf-program-headers" title="Direct link to heading">â€‹</a></h3><p>Segment/ program headers contain information about how can this program be loaded and executed into the memory, theyâ€™re not needed on linktime (to remember: think about the segmentation memory model)</p><p>There are two important keywords that we must absolutely understand:</p><ul><li><code>INTERP</code>: Defines the library that should be used to load this ELF into the memory</li><li><code>LOAD</code>: defines the part of the file that should be loaded into the memory</li></ul><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ readelf -a ./a.out | less</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Program Headers:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Type           Offset             VirtAddr           PhysAddr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                 FileSiz            MemSiz              Flags  Align</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  PHDR           0x0000000000000040 0x0000000000000040 0x0000000000000040</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                 0x00000000000002d8 0x00000000000002d8  R      0x8</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  INTERP         0x0000000000000318 0x0000000000000318 0x0000000000000318</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                 0x000000000000001c 0x000000000000001c  R      0x1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      [Requesting program interpreter: /lib64/ld-linux-x86-64.so.2]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  LOAD           0x0000000000000000 0x0000000000000000 0x0000000000000000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                 0x0000000000000618 0x0000000000000618  R      0x1000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  LOAD           0x0000000000001000 0x0000000000001000 0x0000000000001000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                 0x0000000000000161 0x0000000000000161  R E    0x1000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  LOAD           0x0000000000002000 0x0000000000002000 0x0000000000002000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                 0x00000000000000d4 0x00000000000000d4  R      0x1000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  LOAD           0x0000000000002de8 0x0000000000003de8 0x0000000000003de8</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                 0x0000000000000248 0x0000000000000250  RW     0x1000</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="how-loading-takes-place">How loading takes place?<a class="hash-link" href="#how-loading-takes-place" title="Direct link to heading">â€‹</a></h3><ul><li>To figure out what to load and how to load, the Linux kernel reads the beginning of the file (magic section in the ELF header)</li><li>If the file starts with a shebang #!, it means there is a specific loader (interpreter and the likes) which can help execute this program. The kernel extracts the interpreter path and name from the line, and calls it, with the original file as its argument</li><li>If the file format matches with something present in /proc/sys/fs/binfmt_misc, the kernel executes the interpreter/ loader specified for that format, with the original file as an argument</li></ul><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ ls -1 /proc/sys/fs/binfmt_misc/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">jar</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">llvm-14-runtime.binfmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">python3.10</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">register</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">status</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li>If the ELF is dynamically linked, the kernel reads the interpreter/ loader defined in the ELF, loads the interpreter and the original file, and transfer control to the interpreter. If the ELF is statically linked, the kernel will just load it</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="how-a-dynamically-linked-elf-gets-loaded-into-the-memory">How a dynamically linked ELF gets loaded into the memory<a class="hash-link" href="#how-a-dynamically-linked-elf-gets-loaded-into-the-memory" title="Direct link to heading">â€‹</a></h3><p>The program and its interpreter are loaded by the kernel into the memory by the steps discussed above, and the interpreter further loads libraries into the logical address space of our current program. The interpreter path is specified and can be checked by using readelf -a  program | grep &quot;interpreter&quot; and can be overwritten by using <code>patchelf</code></p><p>The interpreter locates the libraries, and they can be found at:</p><ul><li><code>LD_PRELOAD</code> environment variable, and anything in <code>/etc/ld.so.preload</code></li><li><code>LD_LIBRARY_PATH</code> environment variable</li><li><code>DT_RUNPATH</code>/ <code>DT_RPATH</code> specified in the binary</li><li>system wide configuration <code>/etc/ld.so.conf</code></li><li><code>/lib</code> and <code>/usr/lib</code></li></ul><p>The interpreter loads the libraries</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="execution">Execution<a class="hash-link" href="#execution" title="Direct link to heading">â€‹</a></h2><p>If we look at the ELF header, there is something called the <strong>Entry Point Address</strong> which is used to specify where the execution flow will jump at the start, after the execution of the said ELF starts
If we look at the <code>objdump</code> of the said binary, and look for the address mentioned in the <em>Entry Point Address</em> field, we find:</p><p><img loading="lazy" alt="Preprocessing" src="/assets/images/objdump-2d0f90889c6df81d701fc94f0a1d9b87.png" width="1920" height="984"></p><p>We notice there is a call to the <code>__libc_start_main()</code> function (since the binary was compiled with <code>libc</code>), if it&#x27;s not, the <code>_start</code> directly contains the instructions to execute</p><ul><li>A normal ELF calls <code>__libc_start_main()</code> in libc, and the library in turn will call the ELFâ€™s <code>main()</code> function if our program is compiled and linked with <code>libc</code></li><li>Our ELF reads the environment variables (<code>void **envp</code>)and the arguments provided to it (<code>void **argv</code>)</li></ul><div class="codeBlockContainer_I0IT language-c theme-code-block"><div class="codeBlockContent_wNvx c"><pre tabindex="0" class="prism-code language-c codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> argc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">argv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">envp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="reference-credits-resources">Reference/ Credits/ Resources<a class="hash-link" href="#reference-credits-resources" title="Direct link to heading">â€‹</a></h2><p>Credit where credit is due :)</p><ul><li><a href="https://www.youtube.com/watch?v=A7I0497Up0c" target="_blank" rel="noopener noreferrer">Introduction to Compilers and Stages of Compilation - YouTube</a></li><li><a href="https://www.youtube.com/playlist?list=PLhy9gU5W1fvUND_5mdpbNVHC1WCIaABbP" target="_blank" rel="noopener noreferrer">UIC CS361 by Chris Kanich</a></li><li><a href="https://csapp.cs.cmu.edu/" target="_blank" rel="noopener noreferrer">Computer Systems: A Programmer&#x27;s Perspective</a></li><li><a href="https://pwn.college/" target="_blank" rel="noopener noreferrer">pwn.college by Zardus (Yan Shoshitaishvili) and kanak (Connor Nelson)</a></li><li><a href="https://github.com/mytechnotalent/Reverse-Engineering" target="_blank" rel="noopener noreferrer">Kevin Thomas&#x27;s reverse engineering guide</a></li><li>Executable and Linkable Format 101 by Ignacio Sanmillan (intezer Labs): <a href="https://www.intezer.com/blog/research/executable-linkable-format-101-part1-sections-segments/" target="_blank" rel="noopener noreferrer">Part 1 Sections and Segments</a>, <a href="https://www.intezer.com/blog/malware-analysis/executable-linkable-format-101-part-2-symbols/" target="_blank" rel="noopener noreferrer">Part 2: Symbols</a>, <a href="https://www.intezer.com/blog/malware-analysis/executable-and-linkable-format-101-part-3-relocations/" target="_blank" rel="noopener noreferrer">Part 3: Relocations</a>, <!-- -->[Part 4]<!-- -->(Part 4: Dynamic Linking)</li><li><a href="https://medium.com/ax1al/a-brief-introduction-to-executable-linkable-format-1ed9a3fdcc91" target="_blank" rel="noopener noreferrer">A brief introduction to Executable &amp; Linkable Format by ElementalX2</a></li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/programming/pl-basics"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Why study programming?</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/programming/Program Execution/interediate-interpreted-execution"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Understand the process of how execution of intermediate/ interpreted programs takes place</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#writing-code" class="table-of-contents__link toc-highlight">Writing code</a></li><li><a href="#pre-processing" class="table-of-contents__link toc-highlight">Pre-processing</a></li><li><a href="#compilation" class="table-of-contents__link toc-highlight">Compilation</a><ul><li><a href="#what-are-compilers" class="table-of-contents__link toc-highlight">What are compilers?</a></li><li><a href="#overview-of-c-compilation" class="table-of-contents__link toc-highlight">Overview of C compilation</a></li><li><a href="#lexical-analysis-tokenisation" class="table-of-contents__link toc-highlight">Lexical Analysis (Tokenisation)</a></li><li><a href="#parsing-syntax-analysis" class="table-of-contents__link toc-highlight">Parsing (Syntax Analysis)</a></li><li><a href="#semantic-analysis" class="table-of-contents__link toc-highlight">Semantic Analysis</a></li><li><a href="#intermediate-code-generation" class="table-of-contents__link toc-highlight">Intermediate Code Generation</a></li><li><a href="#code-optimization" class="table-of-contents__link toc-highlight">Code Optimization</a></li><li><a href="#code-generation" class="table-of-contents__link toc-highlight">Code Generation</a></li></ul></li><li><a href="#linking" class="table-of-contents__link toc-highlight">Linking</a><ul><li><a href="#basics" class="table-of-contents__link toc-highlight">Basics</a></li><li><a href="#what-are-symbols" class="table-of-contents__link toc-highlight">What are symbols?</a></li><li><a href="#the-symbol-table" class="table-of-contents__link toc-highlight">The symbol table</a></li><li><a href="#how-an-object-file-looks-like-elf-perspective" class="table-of-contents__link toc-highlight">How an object file looks like (ELF perspective)</a></li><li><a href="#static-linking" class="table-of-contents__link toc-highlight">Static Linking</a></li><li><a href="#dynamic-linking" class="table-of-contents__link toc-highlight">Dynamic Linking</a></li></ul></li><li><a href="#loading" class="table-of-contents__link toc-highlight">Loading</a><ul><li><a href="#understanding-elf-program-headers" class="table-of-contents__link toc-highlight">Understanding ELF program headers</a></li><li><a href="#how-loading-takes-place" class="table-of-contents__link toc-highlight">How loading takes place?</a></li><li><a href="#how-a-dynamically-linked-elf-gets-loaded-into-the-memory" class="table-of-contents__link toc-highlight">How a dynamically linked ELF gets loaded into the memory</a></li></ul></li><li><a href="#execution" class="table-of-contents__link toc-highlight">Execution</a></li><li><a href="#reference-credits-resources" class="table-of-contents__link toc-highlight">Reference/ Credits/ Resources</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Connect</div><ul class="footer__items"><li class="footer__item"><a href="https://www.linkedin.com/in/rohitdhill/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/s4dr0t1" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/s4dr0t1" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://keybase.io/s4dr0t1" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Keybase<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://news.ycombinator.com/submitted?id=s4dr0t1" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>HackerNews<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.reddit.com/user/s4dr0t1" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Reddit<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://keybase.io/s4dr0t1" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Keybase<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Links</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/docs">My Infosec Ramblings</a></li><li class="footer__item"><a class="footer__link-item" href="/projects">Projects</a></li><li class="footer__item"><a class="footer__link-item" href="/#about">About</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Last updated on Tue Aug 16 2022 | Inspired by kayo-folio</div></div></div></footer></div>
<script src="/assets/js/runtime~main.b55d8945.js"></script>
<script src="/assets/js/main.8c95a7e4.js"></script>
</body>
</html>