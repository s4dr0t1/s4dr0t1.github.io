---

title: Digital Certificates
id: digital_certificates

---

> Digital Signatures: What they are, how do they work and why are they important.


## What is what?

### Basics

Digital Certificates acts like a credential, unique in nature, and is used to make sure the supposed public key of the person we're encrypting our data with, is of course associated with that person we want to send the data to viz. It attests the binding of an entity to a public key.

Making sure that we encrypt with the public key of the intended person is important from a security perspective, otherwise we may end up encrypting our data with a bogus key (unintentionally) and it can be leveraged by an adversary.

One of the most common formats of Digital Certificates we see is `X.509`, but there are more out there, such as a PGP certificate.

### X.509 Certificates

![Skeleton of a X.509 certificate](/img/docs/crypto/applications/certificate_format.png)

It contains a lot of information, such as:
- The version of the X.509 standard used
- The serial number of the certificate, which acts as a unique identifier
- Information about the entity, such as Name, Email, Organization etc
- Validity period stating when the certificate will expire
- The Digital Signature, generated by a trusted entity


## How?

### How Are Certificates Requested& Initialized

In this case, Certificate Authority is the **trusted entity** we speak of, or someone designated by the CA. They do the work of issuing, verifying and validating Digital Certificates

To obtain a X.509 certificate, we must request a certificate from a CA, by providing all the requisite information and digitally sign the package with our private key (to imply the ownership of private key). The CA does background checks and information verification to make sure whatever we have mentioned is correct. After all these checks and stuff, we finally get issued a Digital Certificate.

Since the CA can't verify and sign certificates for everyone, as there is a big overhead involved when verifying the information provided, there is a generally distributed architecture followed throughout. One or more CAs form a central ring, and issue certificates to entities, and they in turn, can validate and issue certificates inside their organization and the issued child's certificates would derive the trust from the root certificate.

### How are Digital Signatures Leveraged?

:::note
There are mainly three components of a Digital Certificate: The Public Key, The Digital Signature and information (name and stuff)
:::

![How Are Digital Signatures Leveraged](/img/docs/crypto/applications/signature_leverage.png)

Digital Certificates has a lot of components, one of which is a Digital Signature. It's generated by hashing the public key of the entity, and encrypting it with the private key by an a very trusted person we believe will do its best to verify the identity of the entity, so that we don't have to. 

During the verification phase, the concept of Mutual Trust is established: If X is a very trusted entity, and X trusts Y, I trust X very much, and consequently I'd also trust Y. In this scenario, since a Digital Certificate has been issued and signed by a CA, it means the CA has done its due diligence in verifying all the information and stuff, and we trust the CA. It implies that we indirectly trust that the Public Key is of that supposed entity.

It doesn't attest to all the information mentioned in the Digital Certificate as a whole, just the Public Key of the individual involved.

### Verification Of Digital Signatures

![Verification Of Digital Signatures](/img/docs/crypto/applications/signatures_verification.png)

To verify if the Public Key mentioned in the Digital Certificate has been verified and vetted, by the Certificate Authority, we hash it and compare it with the hash we get by decrypting the Digital Signature with the help of CA's public key. If they come out to be same, it means we can trust that particular public key, if they don't come out to be same, it should immediately raise red flags ([*Man-in-the-middle* Attack](https://simple.wikipedia.org/wiki/Man-in-the-middle_attack))

### Certificate Distribution and Storage

There's always the option of doing all of it manually, but it doesn't scale at all and is very unfeasible for two parties who've never even met.

There are Certificate Servers which are used for the storage and distribution of Digital Certificates, and there is a more advanced form of the same, Public Key Infrastructure (PKI), which is a hierarchy of many systems working together to provide key management features (such as certificate initialization, storage, management, establishing trust etc), and not just storage and distribution.

### Certificate Expiration

- Once a certificate expires (the validity is mentioned there in the Digital Certificate), a new certificate can be requested again from the **Trusted Entity**.
- The lives of these certificates is intentionally kept short, as a workaround for private key compromise. If the private key associated with the Public Key of the entity gets compromised, anyone with it can decrypt the data being sent to it.
- If a certificate is expired, the people this certificate is being sent to, can understand the fact that this certificate is not valid anymore, and any data shouldn't be encrypted with this Public Key.

### Certificate Revocation

There are times when a certificate needs to be revoked viz. It doesn't hold any value and the public key shouldn't be trusted because of several reasons such as: 
- **Private Key Compromise**: If we're encrypting some data with a public key, whose corresponding Private key is leaked out to the world viz. Not so private, anyone can decrypt the data.
- **Root Private Key Compromise**: It's the key used by the CA to sign certificates. This is a very serious security risk. If the private key of a CA gets compromised, they need to revoke all the certificates signed under that private key, otherwise an adversary can issue and sign their own bogus certificates. Check these links for more information:
	- [Diginotar Hack 2011](https://darknetdiaries.com/transcript/3/)
	- [Vaccine Certificate Private Key](https://github.com/ehn-dcc-development/hcert-spec/issues/103)
- **The Entity is not there anymore**: Job change, fired etc
- Some information has been changed associated with the entity such as email, departments within the organization etc. 

Anybody who has signed a certificate, can revoke his signature on the certificate.
If a Certificate has been revoked, there should be a well-established system in place to let the sender know about this revocation, and there are, actually, such as: Certificate Revocation Lists (CRL) and OCSP (Online Status Certificate Protocol)

---

#### Certificate Revocation List (CRL)

![Certificate Revocation Lists](/img/docs/crypto/applications/crl.png)

In this case, a list of revoked certificates is maintained and curated by the Certificate Authority (CA). To check if the Certificate has been revoked or not, we must contact the CA, and download the CRL, look through the big list for the name of our sender to check whether the certificate has been revoked or not.

This method is very resource intensive because the CA would have to deal with a lot of similar traffic, all seeking the CRL and it has some other limitations too:
- The CRL needs to be downloaded each time its updated
- There is no real-time notification service, and we need to do this process manually to keep a checked on the revoked certificates. And it might be sometimes, too late.

---

#### OCSP (Online Certificate Status Protocol)

![Online Certificate Status Protocol](/img/docs/crypto/applications/ocsp.png)

:::info Why OCSP?
OCSP is designed to overcome the aforementioned limitations of CRL.
:::

With OCSP, we can request the status of a Digital Certificate anytime by just using the serial number of the certificate.
- We can verify the revocation status by querying the OCSP server with the said serial number of the certificate, instead of checking CRLs.
- The OCSP responder in turn, responds back with the revocation status of the said certificate.
Every time we want to set up a connection, the other person sends the digital certificate which has the public key. We can verify the revocation status, by querying the OCSP server by using the serial number, instead of downloading CRL. The OCSP responder checks the status and responds to the request

---

#### OCSP Stapling (Online Certificate Status Protocol with Stapling)

![Online Certificate Status Protocol with stapling](/img/docs/crypto/applications/ocsp_stapling.png)

Even though the OCSP we just discussed does it better than CRLs, there are still some drawbacks:
- The responder will still have to deal with a huge amout of requests
- If the client is unable to access the OCSP server (some malware block access to them when a device gets infected), there could be many outcomes, all of which are undesirable
	- Even though the revocation status is not verified, continue with using the Public Key Anyways, destroying the whole purpose of doing revocation checks in the first place
	- Terminate the connection

OSCP with stapling does it differently, instead of the client contacting the OCSP responders, the web servers which sent us the Digital Certificate does that part.

- The web-server contacts the OCSP server instead of the client (reducing traffic for the OCSP server) and keeps a digitally signed response of the Revocation Status.
- During the SSL handshake process, when the web server sends its Digital Certificate, it also sends the Digitally Signed response of the Revocation Status alongwith the certificate
- The client instead of contacting CRL servers, or querying the OCSP responder, would just check the Signed Response (by the OCSP server) and take decisions based on that.

:::info How is OCSP Stapling different from OCSP?
OCSP leaks metadata (such as the serial number of the certificate) when we're querying the OCSP responder. An adversary acting as the *man-in-the-middle* can easily find which website we were trying to visit based on that certificate serial number even when we're using encrypted DNS (DoT/ DoH etc). This is a risk to personal freedom and can be leveraged by oppressive governments to augment their censorship techniques.

In the case of OCSP stapling, there is no direct contact b/w the client and the OCSP server, and as a result the metadata doesn't leak.

Check this detailed blog post for more information: [Link](https://blog.seanmcelroy.com/2019/01/05/ocsp-web-activity-is-not-private/)
